{% extends '_layout.jinja2' %}
{% import 'utils/_progress.jinja2' as progress %}

{% block main %}
  <a href="{{ url_for('refresh_all') }}">Refresh Cache</a>
  <h1>Timeline from {{ stones_by_step[0][0].strftime('%B %Y') }} to {{ stones_by_step[-1][0].strftime('%B %Y') }}</h1>
  {% for month, stones in stones_by_step %}
    <article>
      <h2>{{ month.strftime('%B %Y') }}</h2>
      {% if stones %}
        <ul>
          {% for stone in stones | sort(attribute='due_on') %}
            <li class="{{ stone.state }}">
              {{ stone.due_on.strftime('%d') }} {{ stone.repo }}
              <a href="{{ stone.html_url }}">{{ stone.title }}</a>
              {{ progress.render(stone.open_issues, stone.closed_issues) }}
            </li>
          {% endfor %}
        </ul>
      {% endif %}
    </article>
  {% endfor %}

{% endblock main %}
